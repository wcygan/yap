apiVersion: skaffold/v4beta9
kind: Config
metadata:
  name: auth-db-configurations
manifests:
  rawYaml:
    - auth-db/k8s/pg-init.yaml
    - auth-db/k8s/deployment.yaml
    - auth-db/k8s/service.yaml
deploy:
  kubectl: {}
portForward:
  - resourceType: deployment
    resourceName: auth-db
    port: 5432
    localPort: 5432
---
apiVersion: skaffold/v4beta9
kind: Config
metadata:
  name: auth-service
requires:
  - configs:
      - auth-db-configurations
manifests:
  rawYaml:
    - auth-service/k8s/deployment.yaml
    - auth-service/k8s/service.yaml
build:
  local:
    concurrency: 0
  artifacts:
    - image: auth-service
      context: .
      docker:
        dockerfile: auth-service/Dockerfile
deploy:
  kubectl: {}
---
apiVersion: skaffold/v4beta9
kind: Config
metadata:
  name: chat-service
requires:
  - configs:
      - auth-db-configurations
manifests:
  rawYaml:
    - chat-service/k8s/deployment.yaml
    - chat-service/k8s/service.yaml
build:
  local:
    concurrency: 0
  artifacts:
    - image: chat-service
      context: .
      docker:
        dockerfile: chat-service/Dockerfile
deploy:
  kubectl: {}
---
apiVersion: skaffold/v4beta9
kind: Config
metadata:
  name: yap-api
requires:
  - configs:
      - auth-service
      - chat-service
manifests:
  rawYaml:
    - yap-api/k8s/deployment.yaml 
    - yap-api/k8s/service.yaml
build:
  local:
    concurrency: 0
  artifacts:
    - image: yap-api
      context: .
      docker:
        dockerfile: yap-api/Dockerfile
deploy:
  kubectl: {}
portForward:
  # This port-forwarding enables clients to connect to the yap-api service
  - resourceType: deployment
    resourceName: yap-api
    port: 50050
    localPort: 50050
